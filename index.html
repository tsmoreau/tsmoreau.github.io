<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Depict Limited ALPHA</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="./Depict Limited ALPHA/bootstrap.min.css" type="text/css">

    <!-- Custom Fonts -->
    <link href="./Depict Limited ALPHA/css" rel="stylesheet" type="text/css">
    <link href="./Depict Limited ALPHA/css(1)" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="./Depict Limited ALPHA/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="./Depict Limited ALPHA/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
   
    <!-- Plugin CSS -->
    <link rel="stylesheet" href="./Depict Limited ALPHA/animate.min.css" type="text/css">
    <link rel="stylesheet" href="./Depict Limited ALPHA/style.css">
    <link rel="stylesheet" href="./Depict Limited ALPHA/swiper-bundle.css">

    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="css/creative.css" type="text/css">  -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>

        .modal {
            position: absolute;
            width: 100%;
            height: 100vh;
            top: 0;
            left: 0;
            display: none;
        }


        .overLay {
            position: absolute;
            top: 0;
            left: 0;
            background: black;
            opacity: 0.8;
            width: 100%;
            height: 100vh;
            z-index: 10;
        }


        .modal .inner {
            position: absolute;
            z-index: 11;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);

        }
    </style>

</head>

<body id="page-top">

    <nav id="mainNav" class="navbar navbar-default affix-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="https://depict.limited/index.html">Depict Limited ALPHA</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>


  
    <div class="modal" id="modal01">

        
        <div class="overLay modalClose"></div>

     
        <div class="inner" id="preview">

        </div>

    </div>

    <!-- <div class="container">
        <div class="row">
            <form id="fileform">
                <input type="file" class="form-control-file" id="publish" accept="image">
            </form>
        </div>
    </div> -->



    <section>

        <form id="ipfsForm">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <h5>Suports PNG, JPEG, GIF.</h5>
                        <div class="form-group">
                            <label class="control-label">Upload to Decentralized Pictures</label>
                            <ol style="list-style-type: decimal">
                                <li>
                                    Choose image file.
                                </li>
                                <li>
                                    Preview.
                                </li>
                                <li>
                                    Confirm Transaction.
                                </li>
                            </ol>

                            <label class="control-label">Choose image file</label>

                            <div class="dropzone-wrapper">
                                <div class="dropzone-desc">
                                    <i class="glyphicon glyphicon-download-alt"></i>
                                    <p>Select or Drop image file</p>
                                </div>
                                <input type="file" name="img_logo" class="dropzone" id="publish" accept="image/*">
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </form>
    </section>
    <script>
      var web3;

      function createNonce() {

          var dict = "abcdefghijklmnopqrstuvwxyz0123456789".split("");
          var result = "";

          for(var i = 0; i < 10; i++) {
              var rand = Math.floor(Math.random() * 36);
              result += dict[rand];
          }

          return result;

      }

      function getAddress() {
          return new Promise(function(resolve, reject) {

              web3 = new Web3(window.ethereum);

              web3.eth.getCoinbase(function(error, coinbase) {

                  if(!coinbase) window.alert('MetaMask not activated!');

                  var publicAddress = coinbase.toLowerCase();
                  resolve(publicAddress);

              });

          });
      }

      function getSignature(publicAddress) {
          return new Promise(function(resolve, reject) {

              var data = createNonce();

              web3.eth.personal.sign(
                  data,
                  publicAddress,
                  '', // password is ignored by metamask
                  function(error, signature) {

                      var result = {
                          address: publicAddress,
                          nonce: data,
                          signature: signature
                      };

                      resolve(result);

                  }
              );

          });
      }

      function showWeb3Result(result) {

          document.getElementById('text-address').value = result.address;
          document.getElementById('text-nonce').value = result.nonce;
          document.getElementById('text-signature').value = result.signature;

          return result;

      }

      function getToken(result) {
          return new Promise(function(resolve, reject) {

              axios.post('/api/auth', {
                  'publicAddress': result.address,
                  'nonce': result.nonce,
                  'signature': result.signature
              }).then(function(response) { resolve(response.data.token); })

          });
      }

      function showBackendResult(token) {

          document.getElementById('text-token').value = token;

      }

      function buttonClicked() {

          window.ethereum.enable()
              .then(getAddress)
              .then(getSignature)
              .then(showWeb3Result)
              .then(getToken)
              .then(showBackendResult);

      }
  </script>

    
    <hr class="solid">




<button class="btn btn-primary" id="btn-connect">
  Connect wallet
</button>

    <!-- jQuery -->
    <script src="./Depict Limited ALPHA/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="./Depict Limited ALPHA/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="./Depict Limited ALPHA/jquery.easing.min.js"></script>
    <script src="./Depict Limited ALPHA/jquery.fittext.js"></script>
    <script src="./Depict Limited ALPHA/wow.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="./Depict Limited ALPHA/creative.js"></script>
    <script src="./Depict Limited ALPHA/swiper-bundle.js"></script>

    <!-- Depict Limited Chain logic -->
    <script src="./Depict Limited ALPHA/app.js"></script>
    
    <script src="./Depict Limited ALPHA/web3.min.js"></script>
    
    <script src="./Depict Limited ALPHA/contract_abi.js"></script>

    <script src="./Depict Limited ALPHA/bootbox.min.js"></script>

    <script type="text/javascript" src="https://unpkg.com/web3modal@1.9.0/dist/index.js"></script>
    <script type="text/javascript" src="https://unpkg.com/evm-chains@0.2.0/dist/umd/index.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@walletconnect/web3-provider@1.2.1/dist/umd/index.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/fortmatic@2.0.6/dist/fortmatic.js"></script>

    <script src="./Depict Limited ALPHA/buffer.js"></script>
    <script src="./Depict Limited ALPHA/ipfs.js"></script>

    <script>
        var contract;
        var contractAddress;
        var userAccount;
        var imageHash = 0;
        var ipfs2 = window.IpfsApi({ host: 'ipfs.infura.io', protocol: 'https' })

        $(function () {

            function startApp() {
                contractAddress = "0x8375ea2e4d5CB682ed1eeaDE24D82E0c17cFb313";
                contract = new web3js.eth.Contract(contractABI, contractAddress);


                var accountInterval = setInterval(function () {
                    window.web3.eth.getAccounts((error, accounts) => {
                        if (accounts.length == 0) {

                        } else {
                            if (accounts[0] !== userAccount) {
                                userAccount = accounts[0];
                            }
                        }
                    });
                }, 1000);
            }

            window.addEventListener(`load`, function () {

                if (typeof web3 !== `undefined`) {
                    web3js = new Web3(web3.currentProvider);
                    ready = true;
                    startApp();
                }

            });

            function readFile(input) {

                var digitalArt = document.getElementById("publish");
                var idxDot = digitalArt.value.lastIndexOf(".") + 1;
                var extFile = digitalArt.value.substr(idxDot, digitalArt.value.length).toLowerCase();
                if (extFile == "jpeg" || extFile == "png"|| extFile == "jpg" || extFile == "gif") {

                    $("#upload").prop("disabled", true);
                    $("#modal01").fadeIn();
                    $("#preview").append('<p id="uploading" style="color:white">Now uploading your image...</p>')
                    var reader = new FileReader();
                    reader.onloadend = function (event) {
                        console.log(reader.result)
                        var buf = buffer.Buffer(reader.result)

                        ipfs2.add(buf, (err, result) => {
                            imageHash = result[0].hash;
                            var url = "https://ipfs.io/ipfs/" + imageHash;
                            console.log(url);
                            $("#preview").append($('<img>').attr({
                                id: "lastConfirm",
                                src: url,
                                width: 300,
                                height: 300

                            }));
                            $("#lastConfirm").bind('load', function () {
                                $("#uploading").text('Your NFT is almost ready! Please confirm the transaction');
                                $("#preview").append('<br><br><button type="button" id="confirm" class="btn btn-primary btn-block" style="cursor: pointer">Publish</button><button type="button" id="cancel" class="btn btn-light btn-block">Cancel</button>')

                            });

                        });
                    }
                    reader.readAsArrayBuffer(digitalArt.files[0]);
                } else {
                    alert("Only jpeg/gif/png files are allowed!");
                }

            }

            $(document).on("click", "#confirm", function () {

                contract.methods.createDigitalArtFee().call().then(function (val) {

                    contract.methods.mintDigitalArt(imageHash)
                        .send({ from: userAccount, value: val, gasLimit: "360000" })
                        .on("transactionHash", function (_receipt) {
                            clearImage();
                            bootbox.alert("Your NFT has been minted. txhash:" + _receipt);

                        })
                        .on("receipt", function (_receipt) {
                            console.log(_receipt);
                        })
                        .on("error", function (_error) {
                            console.log(_error);

                        })
                });

            });

            $(document).on("click", "#cancel", function () {
                clearImage();
            });

            function clearImage() {
                imageHash = 0;
                $("#preview").empty();
                $("#modal01").fadeOut();
            }


            $(".dropzone").change(function () {
                readFile(this);
            });
        });

    </script>

<script>"use strict";

  /**
   * Example JavaScript code that interacts with the page and Web3 wallets
   */
  
   // Unpkg imports
  const Web3Modal = window.Web3Modal.default;
  const WalletConnectProvider = window.WalletConnectProvider.default;
  const Fortmatic = window.Fortmatic;
  const evmChains = window.evmChains;
  
  // Web3modal instance
  let web3Modal
  
  // Chosen wallet provider given by the dialog window
  let provider;
  
  
  // Address of the selected account
  let selectedAccount;
  
  
  /**
   * Setup the orchestra
   */
  function init() {
  
    console.log("Initializing example");
    console.log("WalletConnectProvider is", WalletConnectProvider);
    console.log("Fortmatic is", Fortmatic);
    console.log("window.web3 is", window.web3, "window.ethereum is", window.ethereum);
  
    // Check that the web page is run in a secure context,
    // as otherwise MetaMask won't be available
    if(location.protocol !== 'https:') {
      // https://ethereum.stackexchange.com/a/62217/620
      const alert = document.querySelector("#alert-error-https");
      alert.style.display = "block";
      document.querySelector("#btn-connect").setAttribute("disabled", "disabled")
      return;
    }
  
    // Tell Web3modal what providers we have available.
    // Built-in web browser provider (only one can exist as a time)
    // like MetaMask, Brave or Opera is added automatically by Web3modal
    const providerOptions = {
      walletconnect: {
        package: WalletConnectProvider,
        options: {
          // Mikko's test key - don't copy as your mileage may vary
          infuraId: "8043bb2cf99347b1bfadfb233c5325c0",
        }
      },
  
      fortmatic: {
        package: Fortmatic,
        options: {
          // Mikko's TESTNET api key
          key: "pk_test_391E26A3B43A3350"
        }
      }
    };
  
    web3Modal = new Web3Modal({
      cacheProvider: false, // optional
      providerOptions, // required
      disableInjectedProvider: false, // optional. For MetaMask / Brave / Opera.
    });
  
    console.log("Web3Modal instance is", web3Modal);
  }
  
  
  /**
   * Kick in the UI action after Web3modal dialog has chosen a provider
   */
  async function fetchAccountData() {
  
    // Get a Web3 instance for the wallet
    const web3 = new Web3(provider);
  
    console.log("Web3 instance is", web3);
  
    // Get connected chain id from Ethereum node

    // Load chain information over an HTTP API
  
    // Get list of accounts of the connected wallet
    const accounts = await web3.eth.getAccounts();
  
    // MetaMask does not give you all accounts, only the selected account
    console.log("Got accounts", accounts);
    selectedAccount = accounts[0];
  
    document.querySelector("#selected-account").textContent = selectedAccount;
  
    // Get a handl
    const template = document.querySelector("#template-balance");
    const accountContainer = document.querySelector("#accounts");
  
    // Purge UI elements any previously loaded accounts
    accountContainer.innerHTML = '';
  
    // Go through all accounts and get their ETH balance
    const rowResolvers = accounts.map(async (address) => {
      const balance = await web3.eth.getBalance(address);
      // ethBalance is a BigNumber instance
      // https://github.com/indutny/bn.js/
      const ethBalance = web3.utils.fromWei(balance, "ether");
      const humanFriendlyBalance = parseFloat(ethBalance).toFixed(4);
      // Fill in the templated row and put in the document
      const clone = template.content.cloneNode(true);
      clone.querySelector(".address").textContent = address;
      clone.querySelector(".balance").textContent = humanFriendlyBalance;
      accountContainer.appendChild(clone);
    });
  
    // Because rendering account does its own RPC commucation
    // with Ethereum node, we do not want to display any results
    // until data for all accounts is loaded
    await Promise.all(rowResolvers);
  
    // Display fully loaded UI for wallet data
    document.querySelector("#prepare").style.display = "none";
    document.querySelector("#connected").style.display = "block";
  }
  
  
  
  /**
   * Fetch account data for UI when
   * - User switches accounts in wallet
   * - User switches networks in wallet
   * - User connects wallet initially
   */
  async function refreshAccountData() {
  
    // If any current data is displayed when
    // the user is switching acounts in the wallet
    // immediate hide this data
    document.querySelector("#connected").style.display = "none";
    document.querySelector("#prepare").style.display = "block";
  
    // Disable button while UI is loading.
    // fetchAccountData() will take a while as it communicates
    // with Ethereum node via JSON-RPC and loads chain data
    // over an API call.
    document.querySelector("#btn-connect").setAttribute("disabled", "disabled")
    await fetchAccountData(provider);
    document.querySelector("#btn-connect").removeAttribute("disabled")
  }
  
  
  /**
   * Connect wallet button pressed.
   */
  async function onConnect() {
  
    console.log("Opening a dialog", web3Modal);
    try {
      provider = await web3Modal.connect();
    } catch(e) {
      console.log("Could not get a wallet connection", e);
      return;
    }
  
    // Subscribe to accounts change
    provider.on("accountsChanged", (accounts) => {
      fetchAccountData();
    });
  
    // Subscribe to chainId change
    provider.on("chainChanged", (chainId) => {
      fetchAccountData();
    });
  
    // Subscribe to networkId change
    provider.on("networkChanged", (networkId) => {
      fetchAccountData();
    });
  
    await refreshAccountData();
  }
  
  /**
   * Disconnect wallet button pressed.
   */
  async function onDisconnect() {
  
    console.log("Killing the wallet connection", provider);
  
    // TODO: Which providers have close method?
    if(provider.close) {
      await provider.close();
  
      // If the cached provider is not cleared,
      // WalletConnect will default to the existing session
      // and does not allow to re-scan the QR code with a new wallet.
      // Depending on your use case you may want or want not his behavir.
      await web3Modal.clearCachedProvider();
      provider = null;
    }
  
    selectedAccount = null;
  
    // Set the UI back to the initial state
    document.querySelector("#prepare").style.display = "block";
    document.querySelector("#connected").style.display = "none";
  }
  
  
  /**
   * Main entry point.
   */
  window.addEventListener('load', async () => {
    init();
    document.querySelector("#btn-connect").addEventListener("click", onConnect);
    document.querySelector("#btn-disconnect").addEventListener("click", onDisconnect);
  });
  
  
  </script>
</body></html>
