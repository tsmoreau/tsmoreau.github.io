<!DOCTYPE html>
<html lang="en">

<head> 
<meta charset="utf-8">
  <script type="text/javascript" src="https://unpkg.com/jquery@3.3.1/dist/jquery.js"></script>
  <script type="text/javascript" src="https://unpkg.com/web3@0.20.5/dist/web3.min.js"></script>
  <link rel="stylesheet" href="app.css">
  <script src="app.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
  <body>
<header>
<div class="network-wrapper">Network: <span id="network"></span></div>
<div class="account-wrapper">Account: <span id="account"></span></div>
<div class="balance-wrapper">Balance: <span id="balance"></span></div>
</header>
  
<div class="content">
<div class="count-header">Current Count</div>
<div id="count">-</div>

<div class="button-wrapper">
  <div id="increment">Increment</div>
  <div id="refresh">Refresh</div>
</div>
  
</div>
    
    <p class="codepen" data-height="265" data-theme-id="light" data-default-tab="js,result" data-user="tsmoreau" data-slug-hash="bGexQXv" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Web3 - Increment Watch">
  <span>See the Pen <a href="https://codepen.io/tsmoreau/pen/bGexQXv">
  Web3 - Increment Watch</a> by tsmoreau (<a href="https://codepen.io/tsmoreau">@tsmoreau</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>
    <hr>
    
    
    yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy
    
    
    
    
    <script>
     Increment Number a number using Solidity Smart Contract
// Smart Contract: https://gist.github.com/anonymous/82f97284041f6cfeebfcb407ad0f303d

// Smart Contract's Application Binary Interface (https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI)
var ABI = [
  {
    constant: true,
    inputs: [],
    name: "getCount",
    outputs: [{ name: "", type: "uint256" }],
    payable: false,
    stateMutability: "view",
    type: "function"
  },
  { payable: false, stateMutability: "nonpayable", type: "fallback" },
  {
    anonymous: false,
    inputs: [{ indexed: false, name: "count", type: "uint256" }],
    name: "log_string",
    type: "event"
  }
];

const contractAddress = "0x0FC9DC696eC91B4232a0620a44F44a18f30e5F9F";
const contract = web3.eth.contract(ABI).at(contractAddress);
const getCountFunc = contract.getCount.getData();

const countEl = document.querySelector("#count");
const networkEl = document.querySelector("#network");
const refreshButtonEl = document.querySelector("#refresh");
const incrementButtonEl = document.querySelector("#increment");
const accountEl = document.querySelector("#account");
const balanceEl =  document.querySelector("#balance");

let disableTransactions = false;

contract.log_string().watch((error, result) => {
  console.log("on watch"); 
  console.log(result);
});

web3.version.getNetwork((err, netId) => {
  
  // If this is the Main net, disable the increment button
  if (netId === '1') {
    disableTransactions = true;
    incrementButtonEl.classList = ['disabled'];
  }
  
  const network =
    {
      1: "Mainnet",
      3: "Ropsten Test Network"
    }[netId] || "Unknown Network";

  networkEl.innerText = network;
});

web3.eth.getBlockNumber((error, result) => {
  console.log(result);
})

web3.eth.getAccounts((error, result) => {
  accountEl.innerText = result;
  
  web3.eth.getBalance(result[0], function(error, result) {
    var val = web3.fromWei(result);
    balanceEl.innerText = `${val} ETH`;
  });
})

incrementButtonEl.addEventListener('click', function() {
  if (disableTransactions) {
    return;
  }
  
  web3.eth.sendTransaction(
    {
      to: contractAddress
    },
    (error, result) => {
      console.log(result);
    }
  );
});

function refreshCount() {
  refreshButtonEl.classList = ["disabled"];
  countEl.innerText = '-';
  
  web3.eth.call(
    {
      to: contractAddress,
      data: getCountFunc
    },
    (error, result) => {
      countEl.innerText = parseInt(result, 16);
      refreshButtonEl.classList = [];
    }
  );
}

refreshButtonEl.addEventListener('click', refreshCount);
refreshCount();
      </script>
    
</body>
